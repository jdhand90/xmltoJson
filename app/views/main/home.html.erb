<% xml = File.open(File.dirname(__FILE__) + "/exotic.xml", "r").read %>
<% json = Hash.from_xml(xml).to_json %>
<% regions = {"name" => "regions", "children" => Array.new} %>
<% regionsHash = Hash.new %>
<% stationHash = Hash.new %>
<% hash = JSON.parse(json) %>
<% hash['evec_api']["quicklook"]["sell_orders"]["order"].each do |order|
	sName = order["station_name"].split(" ")[0] 
	region = order["region"];
	case region
	when "10000001" 
	 region = "Derelik"
	when "10000002" 
	 region = "The Forge"
	when "10000003" 
	 region = "Vale of the Silent"
	when "10000004" 
	 region = "UUA-F4"
	when "10000005" 
	 region = "Detorid"
	when "10000006" 
	 region = "Wicked Creek"
	when "10000007" 
	 region = "Cache"
	when "10000008" 
	 region = "Scalding Pass"
	when "10000009" 
	 region = "Insmother"
	when "10000010"
	 region = "Tribute"
	when "10000011"
	 region = "Great Wildlands"
	when "10000012"
	 region = "Curse"
	when "10000013"
	 region = "Malpais"
	when "10000014"
	 region = "Catch"
	when "10000015"
	 region = "Venal"
	when "10000016"
	 region = "Lonetrek"
	when "10000017"
	 region = "J7HZ-F"
	when "10000018"
	 region = "The Spire"
	when "10000019"
	 region = "A821-A"
	when "10000020"
	 region = "Tash-Murkon"
	when "10000021"
	 region = "Outer Passage"
	when "10000022"
	 region = "Stain"
	when "10000023"
	 region = "Pure Blind"
	when "10000025"
	 region = "Immensea"
	when "10000027"
	 region = "Etherium Reach"
	when "10000028"
	 region = "Molden Heath"
	when "10000029" 
	 region = "Geminate"
	when "10000030" 
	 region = "Heimatar"
	when "10000031" 
	 region = "Impass"
	when "10000032" 
	 region = "Sinq Laison"
	when "10000033" 
	 region = "The Citadel"
	when "10000034" 
	 region = "The Kalevala Expanse"
	when "10000035" 
	 region = "Deklein"
	when "10000036" 
	 region = "Devoid"
	when "10000037" 
	 region = "Everyshore"
	when "10000038" 
	 region = "The Bleak Lands"
	when "10000039" 
	 region = "Esoteria"
	when "10000040" 
	 region = "Oasa"
	when "10000041" 
	 region = "Syndicate"
	when "10000042" 
	 region = "Metropolis"
	when "10000043" 
	 region = "Domain"
	when "10000044" 
	 region = "Solitude"
	when "10000045" 
	 region = "Tenal"
	when "10000046" 
	 region = "Fade"
	when "10000047" 
	 region = "Providence"
	when "10000048" 
	 region = "Placid"
	when "10000049" 
	 region = "Khanid"
	when "10000050" 
	 region = "Querious"
	when "10000051" 
	 region = "Cloud Ring"
	when "10000052" 
	 region = "Kador"
	when "10000053" 
	 region = "Cobalt Edge"
	when "10000054" 
	 region = "Aridia"
	when "10000055" 
	 region = "Branch"
	when "10000056" 
	 region = "Feythabolis"
	when "10000057" 
	 region = "Outer Ring"
	when "10000058" 
	 region = "Fountain"
	when "10000059" 
	 region = "Paragon Soul"
	when "10000060" 
	 region = "Delve"
	when "10000061" 
	 region = "Tenerifis"
	when "10000062" 
	 region = "Omist"
	when "10000063" 
	 region = "Period Basis"
	when "10000064" 
	 region = "Essence"
	when "10000065" 
	 region = "Kor-Azor"
	when "10000066" 
	 region = "Perrigen Falls"
	when "10000067" 
	 region = "Genesis"
	when "10000068" 
	 region = "Verge Vendor"
	when "10000069" 
	 region = "Black Rise"
	end
	if regionsHash[region] == nil
		regionsHash[region] = {"name" => region, "children" => Hash.new}
	end
	if regionsHash[region]['children'][sName] == nil
		regionsHash[region]['children'][sName] = {"name" => sName, "buyOrders" => Array.new, "sellOrders" => Array.new}	
	end
	orderHash = {"price" => order["price"], "remaining" => order['vol_remain'], "security" => order["security"], "time" => order["reported_time"]}
	regionsHash[region]['children'][sName]['sellOrders'].push(orderHash)
 end %>
 
 <% hash['evec_api']["quicklook"]["buy_orders"]["order"].each do |order|
	sName = order["station_name"].split(" ")[0] 
	region = order["region"];
	case region
	when "10000001" 
	 region = "Derelik"
	when "10000002" 
	 region = "The Forge"
	when "10000003" 
	 region = "Vale of the Silent"
	when "10000004" 
	 region = "UUA-F4"
	when "10000005" 
	 region = "Detorid"
	when "10000006" 
	 region = "Wicked Creek"
	when "10000007" 
	 region = "Cache"
	when "10000008" 
	 region = "Scalding Pass"
	when "10000009" 
	 region = "Insmother"
	when "10000010"
	 region = "Tribute"
	when "10000011"
	 region = "Great Wildlands"
	when "10000012"
	 region = "Curse"
	when "10000013"
	 region = "Malpais"
	when "10000014"
	 region = "Catch"
	when "10000015"
	 region = "Venal"
	when "10000016"
	 region = "Lonetrek"
	when "10000017"
	 region = "J7HZ-F"
	when "10000018"
	 region = "The Spire"
	when "10000019"
	 region = "A821-A"
	when "10000020"
	 region = "Tash-Murkon"
	when "10000021"
	 region = "Outer Passage"
	when "10000022"
	 region = "Stain"
	when "10000023"
	 region = "Pure Blind"
	when "10000025"
	 region = "Immensea"
	when "10000027"
	 region = "Etherium Reach"
	when "10000028"
	 region = "Molden Heath"
	when "10000029" 
	 region = "Geminate"
	when "10000030" 
	 region = "Heimatar"
	when "10000031" 
	 region = "Impass"
	when "10000032" 
	 region = "Sinq Laison"
	when "10000033" 
	 region = "The Citadel"
	when "10000034" 
	 region = "The Kalevala Expanse"
	when "10000035" 
	 region = "Deklein"
	when "10000036" 
	 region = "Devoid"
	when "10000037" 
	 region = "Everyshore"
	when "10000038" 
	 region = "The Bleak Lands"
	when "10000039" 
	 region = "Esoteria"
	when "10000040" 
	 region = "Oasa"
	when "10000041" 
	 region = "Syndicate"
	when "10000042" 
	 region = "Metropolis"
	when "10000043" 
	 region = "Domain"
	when "10000044" 
	 region = "Solitude"
	when "10000045" 
	 region = "Tenal"
	when "10000046" 
	 region = "Fade"
	when "10000047" 
	 region = "Providence"
	when "10000048" 
	 region = "Placid"
	when "10000049" 
	 region = "Khanid"
	when "10000050" 
	 region = "Querious"
	when "10000051" 
	 region = "Cloud Ring"
	when "10000052" 
	 region = "Kador"
	when "10000053" 
	 region = "Cobalt Edge"
	when "10000054" 
	 region = "Aridia"
	when "10000055" 
	 region = "Branch"
	when "10000056" 
	 region = "Feythabolis"
	when "10000057" 
	 region = "Outer Ring"
	when "10000058" 
	 region = "Fountain"
	when "10000059" 
	 region = "Paragon Soul"
	when "10000060" 
	 region = "Delve"
	when "10000061" 
	 region = "Tenerifis"
	when "10000062" 
	 region = "Omist"
	when "10000063" 
	 region = "Period Basis"
	when "10000064" 
	 region = "Essence"
	when "10000065" 
	 region = "Kor-Azor"
	when "10000066" 
	 region = "Perrigen Falls"
	when "10000067" 
	 region = "Genesis"
	when "10000068" 
	 region = "Verge Vendor"
	when "10000069" 
	 region = "Black Rise"
	end
	if regionsHash[region] == nil
		regionsHash[region] = {"name" => region, "children" => Hash.new}
	end
	if regionsHash[region]['children'][sName] == nil
		regionsHash[region]['children'][sName] = {"name" => sName, "buyOrders" => Array.new, "sellOrders" => Array.new}	
	end
	orderHash = {"price" => order["price"], "security" => order["security"], "remaining" => order['vol_remain'], "time" => order["reported_time"]}
	regionsHash[region]['children'][sName]['buyOrders'].push(orderHash)
 end %>
 
<% regionsHash.each do |key, value| %>
	<% value["children"] = value["children"].values %> 
	<% regions["children"].push(value) %>
<%end%>

<%= regions.to_json %>

